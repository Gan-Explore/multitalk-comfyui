FROM ghcr.io/gan-explore/multitalk-comfyui-base:1.0

# Dev-only tools
RUN pip install jupyterlab ipykernel

EXPOSE 8188
EXPOSE 8888

CMD bash -c "\
  if command -v nvidia-smi >/dev/null 2>&1; then \
    pip install --no-cache-dir \
      torch==2.6.0 \
      torchvision==0.21.0 \
      torchaudio==2.6.0 \
      --index-url https://download.pytorch.org/whl/cu121; \
  fi && \
  jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root \
    --ServerApp.token=\"${JUPYTER_TOKEN}\" \
    --ServerApp.password=\"\" & \
  python main.py --listen 0.0.0.0 --port 8188 \
"
