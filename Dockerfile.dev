FROM ghcr.io/gan-explore/multitalk-comfyui-base:1.0

# Dev-only tools
RUN pip install jupyterlab ipykernel

EXPOSE 8188
EXPOSE 8888

CMD bash -c "\
  echo 'Installing CUDA-compatible torch (runtime)...'; \
  pip install --no-cache-dir torch torchvision torchaudio || true; \
  echo 'Starting JupyterLab...'; \
  jupyter lab \
    --ip=0.0.0.0 \
    --port=8888 \
    --no-browser \
    --allow-root \
    --ServerApp.token=\"${JUPYTER_TOKEN}\" \
    --ServerApp.password=\"\" & \
  echo 'Starting ComfyUI...'; \
  python main.py --listen 0.0.0.0 --port 8188 \
"
